<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
</head> 

<p>This is the host page</p>
<p id="currentlyPlaying"></p>

<script>
    var n = 1
    var songs = []
    var url = window.location.href.split("?")[1].replace("auth=", "")
    setInterval(() => {
        $.ajax({
            url: "/querySongs",
            type: "GET",
            success: function(result) {
                setTimeout(() => {
                    $.ajax({
                        url: ' http://2ae56305.ngrok.io/',
                        type: "POST",
                        data: result,
                        headers: {
                            'Access-Control-Allow-Origin': "*"
                        },
                        success: function(result) {
                            // for(var j = 0; j < result[0].length; j++){
                            //     songs.push(result[0][i].uri)
                            // }
                            console.log(result)
                        }
                    });
                }, 3000)
                
            },
            error:function(error) {
                console.log(`Error ${error}`)
            }
        })
    }, 5000)

    setInterval(() => {
        var song = songs.pop()

        setTimeout(() => {
            $.ajax({
                url: 'https://api.spotify.com/v1/me/player/add-to-queue\?uri=' + song.replace(":", "%3A").replace(":", "%3A"),
                type: "POST",
                headers: {
                    'Authorization': 'Bearer ' + url
                },
                success: function(response) {
                    console.log(response)
                }
            });
        }, 3000)
    }, 5000);
</script>
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
</head> 

<p>This is the host page</p>
<p id="currentlyPlaying">{{currentlyPlaying}}</p>

<script>
    var n = 1
    var songs = []
    var url = window.location.href.split("?")[1].replace("auth=", "")
    setInterval(() => {
        $.ajax({
            url: "/querySongs",
            type: "GET",
            success: function(result) {
                for(var i = 0; i<result[0].length; i++){
                    songs.push(result[0][i].uri)
                    console.log(result)
                }
            },
            error:function(error) {
                console.log(`Error ${error}`)
            }
        })
    }, 5000)

    setInterval(() => {
        $.ajax({
            url: 'https://api.spotify.com/v1/me/player/add-to-queue\?uri=' + songs.pop().replace(":", "%3A"),
            type: "POST",
            headers: {
                'Authorization': 'Bearer ' + url
            },
            success: function(response) {
                console.log(response)
            }
        });
    }, 5000)
    
</script>